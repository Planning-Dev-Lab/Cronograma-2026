<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Observa√ß√£o - Atividade</title>
    <link rel="stylesheet" href="css/form.css">
</head>

<body>
    <div class="container" id="container-observacao">
        <h3 id="titulo-observacao">Adicionar Observa√ß√£o</h3>

        <!-- Cards informativos -->
        <div class="info-card" id="info-data">
            <span class="info-label">üìÖ Data:</span>
            <span class="info-value" id="valor-data">13/02/2026</span>
        </div>

        <div class="info-card" id="info-empresa">
            <span class="info-label">üè¢ Empresa:</span>
            <span class="info-value" id="valor-empresa">VERTIV</span>
        </div>

        <div class="info-card" id="info-atividade">
            <span class="info-label">üîß Atividade:</span>
            <span class="info-value" id="valor-atividade">RPP - DATAHALL / TI</span>
        </div>

        <!-- Formul√°rio -->
        <form id="form-observacao" class="form-observacao">
            <!-- Campos ocultos (herdados) -->
            <input type="hidden" name="data" id="campo-data" value="2026-02-13">
            <input type="hidden" name="empresa" id="campo-empresa" value="VERTIV">
            <input type="hidden" name="descricao_atividade" id="campo-descricao" value="RPP - DATAHALL / TI">

            <!-- Campo observa√ß√£o -->
            <div class="campo-grupo" id="grupo-observacao">
                <label for="campo-observacao" class="campo-label">üìù Observa√ß√£o:</label>
                <textarea id="campo-observacao" name="observacao" class="campo-textarea" rows="4" required
                    placeholder="Digite aqui suas observa√ß√µes sobre esta atividade..."></textarea>

            </div>

            <!-- Bot√µes -->
            <div style="padding: 5px 0px;" class="botoes-grupo" id="grupo-botoes">
                <button type="submit" id="btn-enviar" class="btn btn-primary">
                    ‚úÖ Enviar Observa√ß√£o
                </button>
                <button type="button" id="btn-cancelar" class="btn btn-secondary">
                    ‚ùå Cancelar
                </button>
            </div>
        </form>

        <!-- √Årea de feedback (opcional) -->
        <div id="feedback-mensagem" class="feedback" style="display: none;"></div>
    </div>

    <!-- Script para pr√©-preenchimento (quando vier de outra p√°gina) -->
    <!-- Script √öNICO e definitivo -->
    <script>
        // URL no ESCOPO GLOBAL (acess√≠vel no console)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxai4bGJV_OFjEMcdA01IqFb42ovLibG-cBLmVLb_Rj9KJ1iJ-zsVJLjazvyWBVpk3r/exec';

        (function () {
            // Capturar par√¢metros da URL
            const urlParams = new URLSearchParams(window.location.search);

            // Elementos do DOM
            const campoData = document.getElementById('campo-data');
            const campoEmpresa = document.getElementById('campo-empresa');
            const campoDescricao = document.getElementById('campo-descricao');
            const campoObservacao = document.getElementById('campo-observacao');

            const valorData = document.getElementById('valor-data');
            const valorEmpresa = document.getElementById('valor-empresa');
            const valorAtividade = document.getElementById('valor-atividade');
            const feedback = document.getElementById('feedback-mensagem');
            const btnEnviar = document.getElementById('btn-enviar');

            // Preencher dados da URL
            if (urlParams.has('data')) {
                const dataRaw = urlParams.get('data');
                campoData.value = dataRaw;

                if (dataRaw.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    const [ano, mes, dia] = dataRaw.split('-');
                    valorData.textContent = `${dia}/${mes}/${ano}`;
                } else {
                    valorData.textContent = dataRaw;
                }
            }

            if (urlParams.has('empresa')) {
                const empresa = urlParams.get('empresa');
                campoEmpresa.value = empresa;
                valorEmpresa.textContent = empresa;
            }

            if (urlParams.has('descricao')) {
                const descricao = urlParams.get('descricao');
                campoDescricao.value = descricao;
                valorAtividade.textContent = descricao;
            }

            // Bot√£o Cancelar
            document.getElementById('btn-cancelar').addEventListener('click', function () {
                if (confirm('Deseja realmente cancelar?')) {
                    window.close();
                }
            });

            // Bot√£o Enviar
            document.getElementById('form-observacao').addEventListener('submit', async function (e) {
                e.preventDefault();

                const observacao = campoObservacao.value.trim();

                if (observacao.length < 10) {
                    alert('A observa√ß√£o deve ter pelo menos 10 caracteres.');
                    return;
                }

                btnEnviar.disabled = true;
                btnEnviar.textContent = '‚è≥ Enviando...';

                const dados = {
                    data: campoData.value,
                    empresa: campoEmpresa.value,
                    descricao_atividade: campoDescricao.value,
                    observacao: observacao
                };

                console.log('üì§ Enviando para Apps Script:', dados);
                console.log('üîó URL:', APPS_SCRIPT_URL);

                try {
                    const response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dados)
                    });

                    console.log('‚úÖ Requisi√ß√£o enviada (no-cors, n√£o podemos ver resposta)');

                    feedback.style.display = 'block';
                    feedback.className = 'feedback sucesso';
                    feedback.innerHTML = '‚úÖ Observa√ß√£o enviada com sucesso!';

                    campoObservacao.value = '';

                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);

                } catch (error) {
                    console.error('‚ùå Erro no fetch:', error);

                    feedback.style.display = 'block';
                    feedback.className = 'feedback erro';
                    feedback.innerHTML = '‚ùå Erro ao enviar. Tente novamente.';

                    btnEnviar.disabled = false;
                    btnEnviar.textContent = '‚úÖ Enviar Observa√ß√£o';
                }
            });
        })();
    </script>
    <script>
        (function () {
            const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzO1iohoxrNreXG-dsjzAUxYUwKKMncjRcxzYPiuW6DwuiZlJbqpUssxl-15gUoVOlu/exec';

            // Capturar par√¢metros da URL
            const urlParams = new URLSearchParams(window.location.search);

            // Elementos do DOM
            const campoData = document.getElementById('campo-data');
            const campoEmpresa = document.getElementById('campo-empresa');
            const campoDescricao = document.getElementById('campo-descricao');
            const campoObservacao = document.getElementById('campo-observacao');

            const valorData = document.getElementById('valor-data');
            const valorEmpresa = document.getElementById('valor-empresa');
            const valorAtividade = document.getElementById('valor-atividade');
            const feedback = document.getElementById('feedback-mensagem');
            const btnEnviar = document.getElementById('btn-enviar');

            // Preencher dados da URL
            if (urlParams.has('data')) {
                const dataRaw = urlParams.get('data');
                campoData.value = dataRaw;

                if (dataRaw.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    const [ano, mes, dia] = dataRaw.split('-');
                    valorData.textContent = `${dia}/${mes}/${ano}`;
                } else {
                    valorData.textContent = dataRaw;
                }
            }

            if (urlParams.has('empresa')) {
                const empresa = urlParams.get('empresa');
                campoEmpresa.value = empresa;
                valorEmpresa.textContent = empresa;
            }

            if (urlParams.has('descricao')) {
                const descricao = urlParams.get('descricao');
                campoDescricao.value = descricao;
                valorAtividade.textContent = descricao;
            }

            // Bot√£o Cancelar
            document.getElementById('btn-cancelar').addEventListener('click', function () {
                if (confirm('Deseja realmente cancelar?')) {
                    window.close();
                }
            });

            // Bot√£o Enviar
            document.getElementById('form-observacao').addEventListener('submit', async function (e) {
                e.preventDefault();

                const observacao = campoObservacao.value.trim();

                if (observacao.length < 10) {
                    alert('A observa√ß√£o deve ter pelo menos 10 caracteres.');
                    return;
                }

                btnEnviar.disabled = true;
                btnEnviar.textContent = '‚è≥ Enviando...';

                const dados = {
                    data: campoData.value,
                    empresa: campoEmpresa.value,
                    descricao_atividade: campoDescricao.value,
                    observacao: observacao
                };

                console.log('Enviando:', dados);

                try {
                    await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dados)
                    });

                    feedback.style.display = 'block';
                    feedback.className = 'feedback sucesso';
                    feedback.innerHTML = '‚úÖ Observa√ß√£o enviada com sucesso!';

                    campoObservacao.value = '';

                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);

                } catch (error) {
                    console.error('Erro:', error);

                    feedback.style.display = 'block';
                    feedback.className = 'feedback erro';
                    feedback.innerHTML = '‚ùå Erro ao enviar. Tente novamente.';

                    btnEnviar.disabled = false;
                    btnEnviar.textContent = '‚úÖ Enviar Observa√ß√£o';
                }
            });
        })();
    </script>
</body>

</html>